<div class="page-wrapper toggled" [ngClass]="{ 'toggled': activeSidebar }">
    <app-admin-sidebar/>

    <main class="page-content bg-gray-50 dark:bg-slate-800">
        <app-admin-topbar (toggleClass)="toggleClass()"/>

        <div class="container-fluid relative px-3">
            <div class="layout-specing">
                <div class="min-h-screen bg-gray-50 p-8">
                  <div class="max-w-7xl mx-auto">
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">Manage Blog Posts</h1>

                    <!-- Filters -->
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
                      <input
                        type="text"
                        placeholder="Search by title..."
                        [(ngModel)]="searchTerm"
                        (input)="filterPosts()"
                        class="w-full md:w-1/3 px-4 py-2 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500"
                      />

                      <select
                        [(ngModel)]="selectedStatus"
                        (change)="filterPosts()"
                        class="w-full md:w-1/4 px-4 py-2 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500"
                      >
                        <option value="all">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                      </select>
                    </div>

                    <!-- Loading State -->
                    <div *ngIf="loading" class="text-center py-10 text-gray-500">
                      Loading posts...
                    </div>

                    <!-- Posts Table -->
                    <div *ngIf="!loading && filteredPosts.length > 0" class="overflow-x-auto bg-white rounded-2xl shadow-sm">
                      <table class="min-w-full text-left text-sm">
                        <thead class="bg-gray-100">
                          <tr>
                            <th class="px-6 py-4 font-medium text-gray-700">Image</th>
                            <th class="px-6 py-4 font-medium text-gray-700">Title</th>
                            <th class="px-6 py-4 font-medium text-gray-700">Category</th>
                            <th class="px-6 py-4 font-medium text-gray-700">Active</th>
                            <th class="px-6 py-4 font-medium text-gray-700">Publish Date</th>
                            <th class="px-6 py-4 font-medium text-gray-700">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let post of filteredPosts" (dblclick)="editPost(post.id)" class="border-t hover:bg-gray-50 cursor-pointer">
                            <!-- Featured Image -->
                            <td class="px-6 py-4">
                              <img
                                *ngIf="post.featured_image"
                                [src]="post.featured_image"
                                alt="Post Image"
                                class="w-16 h-16 rounded-xl object-cover"
                              />
                            </td>

                            <!-- Title -->
                            <td class="px-6 py-4">
                              <div class="font-medium text-gray-900">{{ post.title }}</div>
                              <div class="text-gray-500 text-xs truncate max-w-xs">
                                <div [innerHTML]="sanitizeContent(post.content)"></div>
                              </div>
                            </td>

                            <!-- Category -->
                            <td class="px-6 py-4 text-gray-700">
                              {{ post.category }}
                            </td>

                            <!-- Active -->
                            <td class="px-6 py-4">
                              <span
                                class="px-2 py-1 rounded-full text-xs font-semibold"
                                [class.bg-green-100]="post.active"
                                [class.text-green-800]="post.active"
                                [class.bg-yellow-100]="!post.active"
                                [class.text-yellow-800]="!post.active"
                              >
                                {{ post.active ? "Yes" : "No" }}
                              </span>
                            </td>

                            <!-- Publish Date -->
                            <td class="px-6 py-4 text-gray-500">
                              {{ post.publish_date | date:'mediumDate' }}
                            </td>

                            <!-- Actions -->
                            <td class="px-6 py-4 space-x-2">
                              <button
                                class="hover:underline"
                                [class.text-green-600]="!post.active"
                                [class.text-gray-600]="post.active"
                                (click)="changeStatus(post)"
                              >
                                {{!post.active ? "Activate" : "Deactivate"}}
                              </button>
                              <button
                                class="text-blue-600 hover:underline"
                                (click)="editPost(post.id)"
                              >
                                Edit
                              </button>
                              <button
                                class="text-red-600 hover:underline"
                                (click)="deletePost(post.id)"
                              >
                                Delete
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    <!-- Empty State -->
                    <div *ngIf="!loading && filteredPosts.length === 0" class="text-center py-10 text-gray-500">
                      No posts found.
                    </div>
                  </div>
                </div>
            </div>
        </div>
        <app-admin-footer/>
    </main>
</div>
